%==============================================================================
% Rotate the 6*6 elastic stiffness matrix using Bond transformation 
%==============================================================================

function [Cnew] = bondTransf(C,R); 

% Construct the Bond matrix B from the rotation matrix R
B = [R(1,1)^2, R(1,2)^2, R(1,3)^2, ...
       R(1,2)*R(1,3), R(1,3)*R(1,1), R(1,1)*R(1,2); ...
     R(2,1)^2, R(2,2)^2, R(2,3)^2, ...
       R(2,2)*R(2,3), R(2,3)*R(2,1), R(2,1)*R(2,2); ...
     R(3,1)^2, R(3,2)^2, R(3,3)^2, ...
       R(3,2)*R(3,3), R(3,3)*R(3,1), R(3,1)*R(3,2); ...
     2*R(2,1)*R(3,1), 2*R(2,2)*R(3,2), 2*R(2,3)*R(3,3), ...
       R(2,2)*R(3,3)+R(2,3)*R(3,2), R(2,1)*R(3,3)+R(2,3)*R(3,1), ...
       R(2,2)*R(3,1)+R(2,1)*R(3,2); ...
     2*R(3,1)*R(1,1), 2*R(3,2)*R(1,2), 2*R(3,3)*R(1,3), ...
       R(1,2)*R(3,3)+R(1,3)*R(3,2), R(1,3)*R(3,1)+R(1,1)*R(3,3), ...
       R(1,1)*R(3,2)+R(1,2)*R(3,1); ...
     2*R(1,1)*R(2,1), 2*R(1,2)*R(2,2), 2*R(1,3)*R(2,3), ...
       R(1,2)*R(2,3)+R(1,3)*R(2,2), R(1,3)*R(2,1)+R(1,1)*R(2,3), ...
       R(1,1)*R(2,2)+R(1,2)*R(2,1)];
 
% Bond transformation
Cnew = B'*C*B; 

%==============================================================================

