%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SORT merges and sorts initial model files of the type "InitModels.in"
% generated by several independent executions of MisfitSort. The models
% are sorted according to the data fit, starting from the best. The
% formats of input/outout files are (and must be) compatible with those
% described in MisfitSort/NonLinGrad programs. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  This is purely an auxiliary program allowing to create a large set of
%  initial sorted models by merging many smaller sets generated by
%  different computers (usually simultaneously generated) = faster
%  generation of denser grid of initial models. 
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

clear all;
close all;
% Make sure the path is correct!
path(path,'/Net/dobrin/home1/pjilek/src/Matlab/NOLIN_Rp/LIB');      %Obj_Rcf library M routines
% this library should be installed - Matlab Optimization Toolbox
%path(path,'.../Optim'); %Optim library M routines

%
% Input:
%

model_ID=input('Model ID: (ISO=0, HTI||HTI=3, HTIxHTI=4, ORT||ORT=5, ORTxORT=6) ');
n_files=input('Number of input files: \n');   
MSort=[];
for I=1:n_files
  temp=input('file name: \n','s');
  file=load(temp);
  [u v]=size(file);
  [x y]=size(MSort);
  MSort(x+1:x+u,:)=file;
end;

%
% Sort:
%

MSort(:,1)=[];
MSort=sortrows(MSort,[1]);
[x y]=size(MSort);

for I=1:x
  FSM(I,:)=[I MSort(I,:)];
end;


% 
% Store: 
% 

fid=fopen('InitModels.in','w');           % Final Sorted Models, starting with the best

if model_ID==0
  fprintf(fid,'%i \t %f \t %f \t %f \t %f \t %f \n',FSM');
elseif model_ID==3
  fprintf(fid,'%i \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \n',FSM');
elseif model_ID==4
  fprintf(fid,'%i \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \n',FSM');
elseif model_ID==5
  fprintf(fid,'%i \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \n',FSM');
elseif model_ID==6
  fprintf(fid,'%i \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \t %f \n',FSM');
end;
fclose(fid);

%%%%%%%% END OF STORY %%%%%%%%%%%%%%%%%%%%%%%%%%%

